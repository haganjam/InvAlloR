<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Using InvAlloR • InvAlloR</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Using InvAlloR">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">InvAlloR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/InvAlloR-detailed-output-description.html">Detailed description of the output</a></li>
    <li><a class="dropdown-item" href="../articles/InvAlloR-technical-information.html">Description of the model forms for the equations</a></li>
    <li><a class="dropdown-item" href="../articles/InvAlloR-user-guide.html">Using InvAlloR</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/haganjam/InvAlloR/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Using InvAlloR</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/haganjam/InvAlloR/blob/HEAD/vignettes/InvAlloR-user-guide.Rmd" class="external-link"><code>vignettes/InvAlloR-user-guide.Rmd</code></a></small>
      <div class="d-none name"><code>InvAlloR-user-guide.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install the package from github</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"haganjam/InvAlloR"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Using GitHub PAT from the git credential store.</span></span>
<span><span class="co">#&gt; Downloading GitHub repo haganjam/InvAlloR@HEAD</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">──</span> <span style="color: #00BBBB;">R CMD build</span> <span style="color: #00BBBB;">─────────────────────────────────────────────────────────────────</span></span></span>
<span><span class="co">#&gt; * checking for file ‘/private/var/folders/my/4qtyd8zj07v9hyr_wfv5wqsh0000gn/T/RtmpTmkX7j/remotesb48839861900/haganjam-InvAlloR-cd2b454/DESCRIPTION’ ... OK</span></span>
<span><span class="co">#&gt; * preparing ‘InvAlloR’:</span></span>
<span><span class="co">#&gt; * checking DESCRIPTION meta-information ... OK</span></span>
<span><span class="co">#&gt; * checking for LF line-endings in source and make files and shell scripts</span></span>
<span><span class="co">#&gt; * checking for empty or unneeded directories</span></span>
<span><span class="co">#&gt; * building ‘InvAlloR_0.0.0.1.tar.gz’</span></span>
<span><span class="co">#&gt; Installing package into '/Users/jamesmac/Library/Caches/org.R-project.R/R/renv/library/InvAlloR-664e1be3/macos/R-4.4/aarch64-apple-darwin20'</span></span>
<span><span class="co">#&gt; (as 'lib' is unspecified)</span></span>
<span></span>
<span><span class="co"># load the package</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/haganjam/InvAlloR" class="external-link">InvAlloR</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Welcome to InvAlloR in version 0.0.0.1</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># load relevant data-processing libraries</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'dplyr'</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     filter, lag</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     intersect, setdiff, setequal, union</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://readr.tidyverse.org" class="external-link">readr</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="using-invallor">Using <code>InvAlloR</code><a class="anchor" aria-label="anchor" href="#using-invallor"></a>
</h2>
<p>To see how we can use <code>InvAlloR</code> to obtain estimates of
the dry biomass of freshwater invertebrates using taxon names and
geographical coordinates, we will start by loading some test data. The
test data consist of invertebrate taxa collected in six temporary ponds
in a nature reserve in Belgium. In addition, the data consist of
latitude-longitude coordinates for the samples as well as measured body
lengths for all the taxa.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># load the test data</span></span>
<span><span class="va">pond_df</span> <span class="op">&lt;-</span> <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span><span class="st">"InvAlloR-vignette-data.csv"</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">Rows: </span><span style="color: #0000BB;">40</span> <span style="font-weight: bold;">Columns: </span><span style="color: #0000BB;">5</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">Column specification</span> <span style="color: #00BBBB;">────────────────────────────────────────────────────────</span></span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">Delimiter:</span> ","</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">chr</span> (2): target_taxon, life_stage</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">dbl</span> (3): lat, lon, length_mm</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Use `spec()` to retrieve the full column specification for this data.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Specify the column types or set `show_col_types = FALSE` to quiet this message.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">pond_df</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 5</span></span></span>
<span><span class="co">#&gt;   target_taxon      life_stage   lat   lon length_mm</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> Acilius sulcatus  adult       51.1  5.33     16.3 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> Acilius sulcatus  larva       51.1  5.33      8.1 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> Agabus striolatus adult       51.1  5.33     10.1 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> Ceratopogonidae   pupa        51.1  5.33     13.3 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> Chaoborus         larva       51.1  5.33     13.1 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> Chironomidae      pupa        51.1  5.33      9.25</span></span>
<span></span>
<span><span class="co"># how many unique taxa are there?</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">pond_df</span><span class="op">$</span><span class="va">target_taxon</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 35</span></span>
<span></span>
<span><span class="co"># check the summary statistics</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">pond_df</span><span class="op">)</span></span>
<span><span class="co">#&gt;  target_taxon        life_stage             lat             lon       </span></span>
<span><span class="co">#&gt;  Length:40          Length:40          Min.   :51.12   Min.   :5.332  </span></span>
<span><span class="co">#&gt;  Class :character   Class :character   1st Qu.:51.12   1st Qu.:5.332  </span></span>
<span><span class="co">#&gt;  Mode  :character   Mode  :character   Median :51.12   Median :5.332  </span></span>
<span><span class="co">#&gt;                                        Mean   :51.12   Mean   :5.332  </span></span>
<span><span class="co">#&gt;                                        3rd Qu.:51.12   3rd Qu.:5.332  </span></span>
<span><span class="co">#&gt;                                        Max.   :51.12   Max.   :5.332  </span></span>
<span><span class="co">#&gt;    length_mm     </span></span>
<span><span class="co">#&gt;  Min.   : 0.459  </span></span>
<span><span class="co">#&gt;  1st Qu.: 6.878  </span></span>
<span><span class="co">#&gt;  Median : 9.455  </span></span>
<span><span class="co">#&gt;  Mean   :11.261  </span></span>
<span><span class="co">#&gt;  3rd Qu.:13.402  </span></span>
<span><span class="co">#&gt;  Max.   :65.000</span></span></code></pre></div>
<p>We want to use the body length data (i.e. <code>length_mm</code>
variable) to estimate the dry biomass for each of these samples using
length-dry biomass allometric equations. The <code>InvAlloR</code>
package houses a database of more than 350 length-dry biomass allometric
equations that represent most major groups of freshwater invertebrates
globally. We can use <code>InvAlloR</code> to search this database for
appropriate length-dry biomass equations for the samples in our test
data (<code>pond_df</code>).</p>
<p>To do this, we have two options both of which rely on the
<code><a href="../reference/get_trait_from_taxon.html">get_trait_from_taxon()</a></code> function. This function (see below)
takes a data.frame with at least five columns. These columns are the
taxon name for which dry biomass data are required, the life stage of
the taxon, the latitude and longitude coordinates from which the taxon
was sampled and body size of the taxon:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/get_trait_from_taxon.html">get_trait_from_taxon</a></span><span class="op">(</span></span>
<span>    <span class="va">data</span>,                   <span class="co"># data.frame with at least five columns: target taxon, life stage, latitude (dd), longitude (dd) and body size (mm) if trait == "equation"</span></span>
<span>    <span class="va">target_taxon</span>,           <span class="co"># character string with the column name containing the taxon names</span></span>
<span>    <span class="va">life_stage</span>,             <span class="co"># character string with the column name containing the life stages</span></span>
<span>    <span class="va">latitude_dd</span>,            <span class="co"># character string with the column name containing the latitude in decimal degrees</span></span>
<span>    <span class="va">longitude_dd</span>,           <span class="co"># character string with the column name containing the longitude in decimal degrees</span></span>
<span>    <span class="va">body_size</span>,              <span class="co"># character string with the column name containing the body size data if trait = "equation"</span></span>
<span>    workflow <span class="op">=</span> <span class="st">"workflow2"</span>, <span class="co"># options are "workflow1" or "workflow2" (default = "workflow2)</span></span>
<span>    max_tax_dist <span class="op">=</span> <span class="fl">3</span>,       <span class="co"># maximum taxonomic distance acceptable between the target and the taxa in the database (default = 3)</span></span>
<span>    trait <span class="op">=</span> <span class="st">"equation"</span>,     <span class="co"># trait to be searched for (default = "equation")</span></span>
<span>    gen_sp_dist <span class="op">=</span> <span class="fl">0.5</span>       <span class="co"># taxonomic distance between a genus and a species(default = 0.5)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="workflow1">
<code>workflow1</code><a class="anchor" aria-label="anchor" href="#workflow1"></a>
</h3>
<p>The first option is <code>workflow1</code>. If <code>workflow1</code>
is chosen, <code><a href="../reference/get_trait_from_taxon.html">get_trait_from_taxon()</a></code> will search the database
and, for each sample in your dataset, it will output all equations that
are within the maximum taxonomic distance (<code>max_tax_dist</code>)
set by the user. We can then use our own discretion to choose which of
these equations we would like to use.</p>
<p>Let’s see how this works:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># we specify the dol_df into the function</span></span>
<span><span class="va">pond_equ1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_trait_from_taxon.html">get_trait_from_taxon</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">pond_df</span>,</span>
<span>  target_taxon <span class="op">=</span> <span class="st">"target_taxon"</span>,</span>
<span>  life_stage <span class="op">=</span> <span class="st">"life_stage"</span>,</span>
<span>  latitude_dd <span class="op">=</span> <span class="st">"lat"</span>,</span>
<span>  longitude_dd <span class="op">=</span> <span class="st">"lon"</span>,</span>
<span>  body_size <span class="op">=</span> <span class="st">"length_mm"</span>, </span>
<span>  workflow <span class="op">=</span> <span class="st">"workflow1"</span>,</span>
<span>  trait <span class="op">=</span> <span class="st">"equation"</span>,</span>
<span>  max_tax_dist <span class="op">=</span> <span class="fl">3.5</span>,</span>
<span>  gen_sp_dist <span class="op">=</span> <span class="fl">0.25</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; &gt;&gt; Family names prepended to scientific names were flagged and removed from 0 records.</span></span>
<span><span class="co">#&gt; &gt;&gt; Terms denoting taxonomic uncertainty were flagged and removed from 0 records.</span></span>
<span><span class="co">#&gt; &gt;&gt; Other issues, capitalizing the first letter of the generic name, replacing empty names by NA, and removing extra spaces, were flagged and corrected or removed from 0 records.</span></span>
<span><span class="co">#&gt; &gt;&gt; Infraspecific terms were flagged and removed from 0 records.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Querying using gbif database version 22.12</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  A total of 0 NA was/were found in sci_name.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  40 names queried in 0.1 minutes</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; &gt;&gt; Family names prepended to scientific names were flagged and removed from 0 records.</span></span>
<span><span class="co">#&gt; &gt;&gt; Terms denoting taxonomic uncertainty were flagged and removed from 0 records.</span></span>
<span><span class="co">#&gt; &gt;&gt; Other issues, capitalizing the first letter of the generic name, replacing empty names by NA, and removing extra spaces, were flagged and corrected or removed from 0 records.</span></span>
<span><span class="co">#&gt; &gt;&gt; Infraspecific terms were flagged and removed from 0 records.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Querying using itis database version 22.12</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  A total of 0 NA was/were found in sci_name.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  40 names queried in 0.1 minutes</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; &gt;&gt; Family names prepended to scientific names were flagged and removed from 0 records.</span></span>
<span><span class="co">#&gt; &gt;&gt; Terms denoting taxonomic uncertainty were flagged and removed from 0 records.</span></span>
<span><span class="co">#&gt; &gt;&gt; Other issues, capitalizing the first letter of the generic name, replacing empty names by NA, and removing extra spaces, were flagged and corrected or removed from 0 records.</span></span>
<span><span class="co">#&gt; &gt;&gt; Infraspecific terms were flagged and removed from 0 records.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Querying using col database version 22.12</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  A total of 0 NA was/were found in sci_name.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  40 names queried in 0.3 minutes</span></span></code></pre></div>
<p>The output is a list of length two with two different data.frames:
the data with relevant equations (<code>data</code>) and a data.frame
with information on how we chose the equations
(<code>decision_df</code>).</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># look at the first few rows of the data element</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">pond_equ1</span><span class="op">$</span><span class="va">data</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 38</span></span></span>
<span><span class="co">#&gt;     row target_taxon     life_stage   lat   lon length_mm habitat_id realm     </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>     1 Acilius sulcatus adult       51.1  5.33      16.3        404 Palearctic</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>     1 Acilius sulcatus adult       51.1  5.33      16.3        404 Palearctic</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>     1 Acilius sulcatus adult       51.1  5.33      16.3        404 Palearctic</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>     1 Acilius sulcatus adult       51.1  5.33      16.3        404 Palearctic</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span>     1 Acilius sulcatus adult       51.1  5.33      16.3        404 Palearctic</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span>     2 Acilius sulcatus larva       51.1  5.33       8.1        404 Palearctic</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 30 more variables: major_habitat_type &lt;chr&gt;, ecoregion &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   clean_target_taxon &lt;chr&gt;, db &lt;chr&gt;, scientificName &lt;chr&gt;, taxonRank &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   acceptedNameUsageID &lt;chr&gt;, taxon_order &lt;chr&gt;, taxon_family &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   trait_out &lt;chr&gt;, db_scientificName &lt;chr&gt;, id &lt;dbl&gt;, tax_distance &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   body_size_range_match &lt;lgl&gt;, life_stage_match &lt;lgl&gt;, r2_match &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   n &lt;dbl&gt;, db_min_body_size_mm &lt;dbl&gt;, db_max_body_size_mm &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   realm_match &lt;lgl&gt;, major_habitat_type_match &lt;lgl&gt;, ecoregion_match &lt;lgl&gt;, …</span></span></span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># look at the first few rows of the decision_df element</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">pond_equ1</span><span class="op">$</span><span class="va">decision_data</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 33</span></span></span>
<span><span class="co">#&gt;     row target_taxon     life_stage   lat   lon length_mm habitat_id realm     </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>     1 Acilius sulcatus adult       51.1  5.33      16.3        404 Palearctic</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>     1 Acilius sulcatus adult       51.1  5.33      16.3        404 Palearctic</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>     1 Acilius sulcatus adult       51.1  5.33      16.3        404 Palearctic</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>     1 Acilius sulcatus adult       51.1  5.33      16.3        404 Palearctic</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span>     1 Acilius sulcatus adult       51.1  5.33      16.3        404 Palearctic</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span>     1 Acilius sulcatus adult       51.1  5.33      16.3        404 Palearctic</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 25 more variables: major_habitat_type &lt;chr&gt;, ecoregion &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   clean_target_taxon &lt;chr&gt;, db &lt;chr&gt;, scientificName &lt;chr&gt;, taxonRank &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   acceptedNameUsageID &lt;chr&gt;, taxon_order &lt;chr&gt;, taxon_family &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   trait_out &lt;chr&gt;, db_scientificName &lt;chr&gt;, id &lt;dbl&gt;, tax_distance &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   body_size_range_match &lt;lgl&gt;, life_stage_match &lt;lgl&gt;, r2_match &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   n &lt;dbl&gt;, db_min_body_size_mm &lt;dbl&gt;, db_max_body_size_mm &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   realm_match &lt;lgl&gt;, major_habitat_type_match &lt;lgl&gt;, ecoregion_match &lt;lgl&gt;, …</span></span></span></code></pre></div>
<p>We’ll start by looking at the outputted data with the equations. To
do this, let’s simply look at the first row of the raw data.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># check the first row of the data that we fed into the function</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">pond_df</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 5</span></span></span>
<span><span class="co">#&gt;   target_taxon     life_stage   lat   lon length_mm</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> Acilius sulcatus adult       51.1  5.33      16.3</span></span></code></pre></div>
<p>Then, let us compare this with what the function outputs:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># check the first row of the output data with the equations</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">pond_equ1</span><span class="op">$</span><span class="va">data</span>, <span class="va">row</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 5 × 38</span></span></span>
<span><span class="co">#&gt;     row target_taxon     life_stage   lat   lon length_mm habitat_id realm     </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>     1 Acilius sulcatus adult       51.1  5.33      16.3        404 Palearctic</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>     1 Acilius sulcatus adult       51.1  5.33      16.3        404 Palearctic</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>     1 Acilius sulcatus adult       51.1  5.33      16.3        404 Palearctic</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>     1 Acilius sulcatus adult       51.1  5.33      16.3        404 Palearctic</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span>     1 Acilius sulcatus adult       51.1  5.33      16.3        404 Palearctic</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 30 more variables: major_habitat_type &lt;chr&gt;, ecoregion &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   clean_target_taxon &lt;chr&gt;, db &lt;chr&gt;, scientificName &lt;chr&gt;, taxonRank &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   acceptedNameUsageID &lt;chr&gt;, taxon_order &lt;chr&gt;, taxon_family &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   trait_out &lt;chr&gt;, db_scientificName &lt;chr&gt;, id &lt;dbl&gt;, tax_distance &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   body_size_range_match &lt;lgl&gt;, life_stage_match &lt;lgl&gt;, r2_match &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   n &lt;dbl&gt;, db_min_body_size_mm &lt;dbl&gt;, db_max_body_size_mm &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   realm_match &lt;lgl&gt;, major_habitat_type_match &lt;lgl&gt;, ecoregion_match &lt;lgl&gt;, …</span></span></span></code></pre></div>
<p>In this output, we have several rows for each input row (these are
labelled with the row column i.e. input row 1 is labelled as ‘1’ in the
row column). For each row from the input data, there are several rows in
this output data. These different rows correspond to different equations
from the database that are within the maximum taxonomic distance that we
set (i.e. 3.5).</p>
<p>The idea with <code>workflow1</code> is for us to now use our
discretion to choose appropriate equations. To look in more detail at
the output, we can also use the <code><a href="https://rdrr.io/r/utils/View.html" class="external-link">View()</a></code> function:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/View.html" class="external-link">View</a></span><span class="op">(</span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">pond_equ1</span><span class="op">$</span><span class="va">data</span>, <span class="va">row</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>The most important columns to consider are the
<code>tax_distance</code> column, the <code>body_size_range_match</code>
column and the <code>life_stage_match</code> column to make an initial
decision. We want low taxonomic distances, we want the length of our
target data to be within the body size range of the equation in the
database (which is specified by the <code>body_size_range_match</code>
column) and, very importantly, we want to the life-stage of our target
to match the life-stage of the equation. There is only one equation that
matches the life-stage (id = 169). Given that the target taxon
(<em>Acilius sulcatus</em>) is a beetle, life-stage is crucially
important. The problem, however, with id = 169 is that the body size
range does not match. Indeed, the equation was developed for body sizes
between 1.4 and 5.2 mm (<code>db_min_body_size_mm</code> and
<code>db_min_body_size_mm</code> columns) and the length in our data is
16.3 mm. Thus, using this equation would be a considerable
extrapolation. Given the non-linearity of many allometric equations,
this may be a problem.</p>
<p>Nonetheless, because the other equations within the appropriate
taxonomic do not have the appropriate life-stage, this is the best that
we can do. We can also use our expert knowledge to check that the
biomass value that we obtain is reasonable for this taxon (e.g. using
other literature, for example). These choices are, of course, subjective
to a certain degree. The point of <code>workflow1</code> is to provide
the relevant information to make informed decisions.</p>
<p>Based on this information, we will choose id = 169 because it is the
only equation with the appropriate life-stage information.</p>
<div class="section level4">
<h4 id="using-the-chosen-equation">Using the chosen equation<a class="anchor" aria-label="anchor" href="#using-the-chosen-equation"></a>
</h4>
<p>In <code>InvAlloR</code>, there is an exported helper function:
<code><a href="../reference/use_equation_database.html">use_equation_database()</a></code>. This function allows the user to
supply a data.frame with a body-size variable
(<code>body_size_var</code>) and an equation-id variable
(<code>equation_id_var</code>) and obtain a data.frame with the relevant
dry-biomass from that equation.</p>
<p>Given that we chose equation-id = 169 for row = 1 (i.e. the first row
in our data), we can extract this information from the <code>data</code>
element of the <code><a href="../reference/get_trait_from_taxon.html">get_trait_from_taxon()</a></code> output. In addition,
we only select the columns that we need to use the equation:
<code>row</code>, <code>id</code>, <code>length_mm</code>:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># extract the first row of data and chosen equation id</span></span>
<span><span class="va">ex1</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">pond_equ1</span><span class="op">$</span><span class="va">data</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">row</span> <span class="op">==</span> <span class="fl">1</span>, <span class="va">id</span> <span class="op">==</span> <span class="fl">169</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">row</span>, <span class="va">id</span>, <span class="va">length_mm</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">ex1</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 3</span></span></span>
<span><span class="co">#&gt;     row    id length_mm</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>     1   169      16.3</span></span></code></pre></div>
<p>We can then use the <code><a href="../reference/use_equation_database.html">use_equation_database()</a></code> function to
use this equation to calculate the dry biomass for the datapoint as
follows:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># calculate the dry-biomass of row 1 using equation id = 169</span></span>
<span><span class="va">ex1</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="../reference/use_equation_database.html">use_equation_database</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">ex1</span>,</span>
<span>                        body_size_var <span class="op">=</span> <span class="st">"length_mm"</span>,</span>
<span>                        equation_id_var <span class="op">=</span> <span class="st">"id"</span><span class="op">)</span></span></code></pre></div>
<p>This function outputs the data with the dry biomass estimate
(<code>output</code> object):</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># view the output</span></span>
<span><span class="va">ex1</span><span class="op">$</span><span class="va">output</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 3</span></span></span>
<span><span class="co">#&gt;   length_mm    id dry_biomass_mg</span></span>
<span><span class="co">#&gt;       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>      16.3   169           56.7</span></span></code></pre></div>
<p>In addition, it outputs the equation metadata so it can be inspected
further if necessary:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># view the metadata</span></span>
<span><span class="va">ex1</span><span class="op">$</span><span class="va">metadata</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 28</span></span></span>
<span><span class="co">#&gt;     row equation_id length_mm db_taxon    db_life_stage preservation</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>     1         169      16.3 Laccophilus adult         none        </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 22 more variables: preservation_percentage &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   correction_percentage &lt;dbl&gt;, correction_factor_id &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   body_size_meas &lt;chr&gt;, body_size_unit &lt;chr&gt;, body_size_min &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   body_size_max &lt;dbl&gt;, equation_form &lt;chr&gt;, log_base &lt;dbl&gt;, a &lt;dbl&gt;, b &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   dry_biomass_scale &lt;dbl&gt;, dry_biomass_min &lt;dbl&gt;, dry_biomass_max &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   dry_biomass_unit &lt;chr&gt;, RMS &lt;dbl&gt;, n &lt;dbl&gt;, r2 &lt;dbl&gt;, lm_correction &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   lm_correction_type &lt;chr&gt;, lm_reference &lt;chr&gt;, reference &lt;dbl&gt;</span></span></span></code></pre></div>
<p>Checking the literature, I found a that ca. 50 mg is not atypical for
a Dysticid diving beetle adult which provides confidence in this
estimate (Klecka and Boukal 2013, Journal of Animal Ecology).</p>
</div>
</div>
<div class="section level3">
<h3 id="workflow2">
<code>workflow2</code><a class="anchor" aria-label="anchor" href="#workflow2"></a>
</h3>
<p>The second option for obtaining dry biomass estimates for a set of
taxa is <code>workflow2</code> which is our automated workflow for
selecting equations. Let’s see how this works:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># we specify the dol_df into the function and select workflow2</span></span>
<span><span class="va">pond_equ2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_trait_from_taxon.html">get_trait_from_taxon</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">pond_df</span>,</span>
<span>  target_taxon <span class="op">=</span> <span class="st">"target_taxon"</span>,</span>
<span>  life_stage <span class="op">=</span> <span class="st">"life_stage"</span>,</span>
<span>  latitude_dd <span class="op">=</span> <span class="st">"lat"</span>,</span>
<span>  longitude_dd <span class="op">=</span> <span class="st">"lon"</span>,</span>
<span>  body_size <span class="op">=</span> <span class="st">"length_mm"</span>, </span>
<span>  workflow <span class="op">=</span> <span class="st">"workflow2"</span>,</span>
<span>  trait <span class="op">=</span> <span class="st">"equation"</span>,</span>
<span>  max_tax_dist <span class="op">=</span> <span class="fl">3.5</span>,</span>
<span>  gen_sp_dist <span class="op">=</span> <span class="fl">0.25</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; &gt;&gt; Family names prepended to scientific names were flagged and removed from 0 records.</span></span>
<span><span class="co">#&gt; &gt;&gt; Terms denoting taxonomic uncertainty were flagged and removed from 0 records.</span></span>
<span><span class="co">#&gt; &gt;&gt; Other issues, capitalizing the first letter of the generic name, replacing empty names by NA, and removing extra spaces, were flagged and corrected or removed from 0 records.</span></span>
<span><span class="co">#&gt; &gt;&gt; Infraspecific terms were flagged and removed from 0 records.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Querying using gbif database version 22.12</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  A total of 0 NA was/were found in sci_name.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  40 names queried in 0.1 minutes</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; &gt;&gt; Family names prepended to scientific names were flagged and removed from 0 records.</span></span>
<span><span class="co">#&gt; &gt;&gt; Terms denoting taxonomic uncertainty were flagged and removed from 0 records.</span></span>
<span><span class="co">#&gt; &gt;&gt; Other issues, capitalizing the first letter of the generic name, replacing empty names by NA, and removing extra spaces, were flagged and corrected or removed from 0 records.</span></span>
<span><span class="co">#&gt; &gt;&gt; Infraspecific terms were flagged and removed from 0 records.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Querying using itis database version 22.12</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  A total of 0 NA was/were found in sci_name.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  40 names queried in 0.1 minutes</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; &gt;&gt; Family names prepended to scientific names were flagged and removed from 0 records.</span></span>
<span><span class="co">#&gt; &gt;&gt; Terms denoting taxonomic uncertainty were flagged and removed from 0 records.</span></span>
<span><span class="co">#&gt; &gt;&gt; Other issues, capitalizing the first letter of the generic name, replacing empty names by NA, and removing extra spaces, were flagged and corrected or removed from 0 records.</span></span>
<span><span class="co">#&gt; &gt;&gt; Infraspecific terms were flagged and removed from 0 records.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Querying using col database version 22.12</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  A total of 0 NA was/were found in sci_name.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  40 names queried in 0.3 minutes</span></span></code></pre></div>
<p>Unlike with <code>workflow1</code>, when we open the output data, it
has the same number of rows as the input data
(i.e. <code>pond_df</code>). That is because <code>InvAlloR</code>
automatically selected an appropriate equation for each row where an
appropriate equation was available in the database. Moreover,
<code>InvAlloR</code> directly calculated the expected dry biomass (see
<em>dry_biomass_mg</em> column) For example, let’s look at the first
row:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># check the first row of the output data with the equations</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">pond_equ2</span><span class="op">$</span><span class="va">data</span>, <span class="va">row</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 39</span></span></span>
<span><span class="co">#&gt;     row target_taxon     life_stage   lat   lon length_mm habitat_id realm</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>     1 Acilius sulcatus adult       51.1  5.33      16.3         <span style="color: #BB0000;">NA</span> <span style="color: #BB0000;">NA</span>   </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 31 more variables: major_habitat_type &lt;chr&gt;, ecoregion &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   clean_target_taxon &lt;chr&gt;, db &lt;chr&gt;, scientificName &lt;chr&gt;, taxonRank &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   acceptedNameUsageID &lt;chr&gt;, taxon_order &lt;chr&gt;, taxon_family &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   trait_out &lt;chr&gt;, db_scientificName &lt;chr&gt;, id &lt;dbl&gt;, tax_distance &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   body_size_range_match &lt;lgl&gt;, life_stage_match &lt;lgl&gt;, r2_match &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   n &lt;dbl&gt;, db_min_body_size_mm &lt;dbl&gt;, db_max_body_size_mm &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   realm_match &lt;lgl&gt;, major_habitat_type_match &lt;lgl&gt;, ecoregion_match &lt;lgl&gt;, …</span></span></span></code></pre></div>
<p>In this case, all the columns are filled with NA values. This is
because there is <em>no appropriate equation for this taxon</em>
according to the <code>InvAlloR</code> <code>workflow2</code> criteria.
For an equation to be selected with <code>workflow2</code>, it has to
meet three conditions:</p>
<ol style="list-style-type: decimal">
<li><p>The taxonomic distance must be less than the maximum taxonomic
taxonomic distance (in this case 3.5 as we set it)</p></li>
<li><p>The target body size must be within the body size range of the
equation (± 30%)</p></li>
<li><p>The life-stage of the target taxon and the equation must
match</p></li>
</ol>
<p>As was clear from looking at this example with
<code>workflow1</code>, there were no equations that met all three of
these criteria. Therefore, we ended up using an equation where the
target body size was not within the body size range of the equation,</p>
<p>Indeed, if we look at the whole output, many of the rows do not have
equations which means that <code>InvAlloR</code> was unable to find
appropriate equations in the database based on these three criteria.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># check the equations chosen</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/View.html" class="external-link">View</a></span><span class="op">(</span><span class="va">pond_equ2</span><span class="op">$</span><span class="va">data</span><span class="op">)</span></span></code></pre></div>
<p>In fact, in this dataset, <code>InvAlloR</code> was only able to find
equations for 25 % of the data points and 29 % of the unique taxa.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># proportion of data points for which appropriate equations were found</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">pond_equ2</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">id</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">pond_equ2</span><span class="op">$</span><span class="va">data</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.25</span></span></code></pre></div>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># proportion of unique taxa for which appropriate equations were found</span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">pond_equ2</span><span class="op">$</span><span class="va">data</span>, <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">target_taxon</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">n</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">pond_equ2</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">target_taxon</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.2857143</span></span></code></pre></div>
<p>If we want to get more insight into why <code>InvAlloR</code> was
unable to find appropriate equations for the different rows, we can look
at the second output which is the <code>decision_data</code>. For each
row, it shows all the equations that were considered and then in the
column called <em>explanation</em>, it explains why a given equation was
not chosen.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># check the decision_data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/View.html" class="external-link">View</a></span><span class="op">(</span><span class="va">pond_equ2</span><span class="op">$</span><span class="va">decision_data</span><span class="op">)</span></span></code></pre></div>
<p>However, in this case, we specified certain levels of maximum
taxonomic distance in the function. What happens if we relax this and
increase the acceptable maximum taxonomic distance and increase it to 4
(instead of 3.5)?</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># we specify the pond_df into the function and select workflow2</span></span>
<span><span class="va">pond_equ2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_trait_from_taxon.html">get_trait_from_taxon</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">pond_df</span>,</span>
<span>  target_taxon <span class="op">=</span> <span class="st">"target_taxon"</span>,</span>
<span>  life_stage <span class="op">=</span> <span class="st">"life_stage"</span>,</span>
<span>  latitude_dd <span class="op">=</span> <span class="st">"lat"</span>,</span>
<span>  longitude_dd <span class="op">=</span> <span class="st">"lon"</span>,</span>
<span>  body_size <span class="op">=</span> <span class="st">"length_mm"</span>, </span>
<span>  workflow <span class="op">=</span> <span class="st">"workflow2"</span>,</span>
<span>  trait <span class="op">=</span> <span class="st">"equation"</span>,</span>
<span>  max_tax_dist <span class="op">=</span> <span class="fl">4</span>,</span>
<span>  gen_sp_dist <span class="op">=</span> <span class="fl">0.25</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; &gt;&gt; Family names prepended to scientific names were flagged and removed from 0 records.</span></span>
<span><span class="co">#&gt; &gt;&gt; Terms denoting taxonomic uncertainty were flagged and removed from 0 records.</span></span>
<span><span class="co">#&gt; &gt;&gt; Other issues, capitalizing the first letter of the generic name, replacing empty names by NA, and removing extra spaces, were flagged and corrected or removed from 0 records.</span></span>
<span><span class="co">#&gt; &gt;&gt; Infraspecific terms were flagged and removed from 0 records.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Querying using gbif database version 22.12</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  A total of 0 NA was/were found in sci_name.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  40 names queried in 0.1 minutes</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; &gt;&gt; Family names prepended to scientific names were flagged and removed from 0 records.</span></span>
<span><span class="co">#&gt; &gt;&gt; Terms denoting taxonomic uncertainty were flagged and removed from 0 records.</span></span>
<span><span class="co">#&gt; &gt;&gt; Other issues, capitalizing the first letter of the generic name, replacing empty names by NA, and removing extra spaces, were flagged and corrected or removed from 0 records.</span></span>
<span><span class="co">#&gt; &gt;&gt; Infraspecific terms were flagged and removed from 0 records.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Querying using itis database version 22.12</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  A total of 0 NA was/were found in sci_name.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  40 names queried in 0.1 minutes</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; &gt;&gt; Family names prepended to scientific names were flagged and removed from 0 records.</span></span>
<span><span class="co">#&gt; &gt;&gt; Terms denoting taxonomic uncertainty were flagged and removed from 0 records.</span></span>
<span><span class="co">#&gt; &gt;&gt; Other issues, capitalizing the first letter of the generic name, replacing empty names by NA, and removing extra spaces, were flagged and corrected or removed from 0 records.</span></span>
<span><span class="co">#&gt; &gt;&gt; Infraspecific terms were flagged and removed from 0 records.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Querying using col database version 22.12</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  A total of 0 NA was/were found in sci_name.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  40 names queried in 0.3 minutes</span></span></code></pre></div>
<p>Do we get a higher proportion of datapoint and taxa with appropriate
equations?</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># proportion of data points for which appropriate equations were found</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">pond_equ2</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">id</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">pond_equ2</span><span class="op">$</span><span class="va">data</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.25</span></span></code></pre></div>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># proportion of unique taxa for which appropriate equations were found</span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">pond_equ2</span><span class="op">$</span><span class="va">data</span>, <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">target_taxon</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">n</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">pond_equ2</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">target_taxon</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.2857143</span></span></code></pre></div>
<p>In this case, we do not. If this occurs, a user can see which
datapoints appropriate equations were not given for and then use the
decision data to see if there are appropriate equations for taxa that
<code>InvAlloR</code> missed. Otherwise, if no good equation can be
found, one might have to use order-level equations instead which are
available in many research papers (e.g. Benke et al. 1999).</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by James Hagan.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.2.</p>
</div>

    </footer>
</div>





  </body>
</html>
